<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quran Flipbook</title>
<style>
body{margin:0;font-family:sans-serif;background:#f0f0f0}
header{padding:12px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,0.1);display:flex;align-items:center;gap:12px}
#uploadForm{display:flex;gap:8px;align-items:center}
#status{color:#666}
.container{padding:12px;height:calc(100vh-60px);display:flex;flex-direction:column}
.viewer{flex:1;display:flex;justify-content:center;align-items:center}
.book{width:90%;height:90%;display:flex;gap:6px;justify-content:center;perspective:2000px}
.page{flex:1;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,0.1);overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer}
.page img{max-width:100%;max-height:100%;object-fit:contain;transition:transform .2s}
.controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:10px}
button,input[type=file]{padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#fff}
.zoom-btn{padding:5px 8px}
.small{font-size:12px;color:#666}
</style>
</head>
<body>
<header>
<div style="font-weight:700">Quran Flipbook</div>
<form id="uploadForm" enctype="multipart/form-data">
<input type="file" name="pdf" accept="application/pdf" required>
<button type="submit">Upload & Convert</button>
</form>
<div id="status" class="small">Select PDF to convert</div>
</header>

<div class="container">
<div class="viewer" id="viewer">
<div class="book" id="book" style="display:none">
<div class="page" id="leftPage"></div>
<div class="page" id="rightPage"></div>
</div>
</div>
<div class="controls" id="controls" style="display:none">
<button id="prev">Prev</button>
<button id="next">Next</button>
<button class="zoom-btn" id="zoomOut">-</button>
<button class="zoom-btn" id="zoomIn">+</button>
<span class="small" id="pageInfo"></span>
</div>
</div>

<script>
(async ()=>{
const uploadForm=document.getElementById('uploadForm');
const status=document.getElementById('status');
const book=document.getElementById('book');
const leftPage=document.getElementById('leftPage');
const rightPage=document.getElementById('rightPage');
const prevBtn=document.getElementById('prev');
const nextBtn=document.getElementById('next');
const zoomIn=document.getElementById('zoomIn');
const zoomOut=document.getElementById('zoomOut');
const controls=document.getElementById('controls');
const pageInfo=document.getElementById('pageInfo');
let files=[],index=0,zoom=1;

function showStatus(t){status.textContent=t;}

uploadForm.addEventListener('submit',async e=>{
e.preventDefault();
const fd=new FormData(uploadForm);
showStatus('Uploading & converting...');
try{
const res=await fetch('/upload',{method:'POST',body:fd});
if(!res.ok)throw new Error(await res.text());
const json=await res.json();
files=json.files;
index=0;
showStatus(`Converted ${files.length} pages`);
book.style.display='flex';
controls.style.display='flex';
renderPair();
updateUI();
}catch(err){console.error(err);showStatus('Failed: '+(err.message||err));}
});

function renderImageInto(el,url){
if(!url){el.innerHTML='';return;}
const img=document.createElement('img');
img.src=url;
img.style.transform=`scale(${zoom})`;
el.innerHTML='';el.appendChild(img);
}

function renderPair(){
renderImageInto(leftPage,files[index]);
renderImageInto(rightPage,files[index+1]);
}

function updateUI(){
pageInfo.textContent=`Page ${index+1} / ${files.length}`;
}

prevBtn.addEventListener('click',()=>{if(index-2>=0)index-=2;renderPair();updateUI();});
nextBtn.addEventListener('click',()=>{if(index+2<files.length)index+=2;renderPair();updateUI();});

zoomIn.addEventListener('click',()=>{zoom+=0.1;renderPair();});
zoomOut.addEventListener('click',()=>{zoom=Math.max(0.5,zoom-0.1);renderPair();});

book.addEventListener('click',e=>{
const rect=book.getBoundingClientRect();
const clickX=e.clientX-rect.left;
if(clickX<rect.width/2){nextBtn.click();}else{prevBtn.click();}
});

// TODO: Add swipe support for mobile if needed (can use touchstart/touchend)
})();
</script>
</body>
</html>